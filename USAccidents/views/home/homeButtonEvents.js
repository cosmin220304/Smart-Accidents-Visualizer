const loader=document.getElementById("originalLoader");function createNewSearch(){let createNewSearch=document.getElementById("createNewSearch"),saveData=document.getElementById("saveData"),colorPicker=document.createElement("input");colorPicker.type="color",colorPicker.name="color",colorPicker.className="colorPicker",createNewSearch.parentNode.insertBefore(colorPicker,createNewSearch),createNewSearch.remove(),colorPicker.onchange=function(){createSearchBlock(colorPicker.value,""),colorPicker.remove();let button=createNewSearch.cloneNode(!0);saveData.parentNode.insertBefore(button,saveData)}}function makeSearch(){return removeAllPoints(),makeSearchHandler(),!1}async function makeSearchHandler(){for(var index=0;index<=searchBlockNo;index++){let block=searchBlocks[index];if(0==block.childNodes.length)continue;let queryString="";for(var i=0;i<block.childNodes.length;i++){var e=block.childNodes[i];"checkbox"!=e.type?"removeButton"!=e.className&&null!=e.value&&(""!=e.value?queryString=queryString+e.name+"="+e.value+"&":alert("empty data in "+e.name+" will not be sent to server!")):queryString=queryString+e.name+"="+e.checked.toString().toUpperCase()+"&"}let color="rgb(0, 0, 0)";"searchBlockStart"!=searchBlocks[index].id&&(color=searchBlocks[index].style.backgroundColor);let loadClone=loader.cloneNode(!0);loadClone.style.display="block",searchBlocks[index].appendChild(loadClone),await queryToPoints(searchBlocks[index],queryString,color),loadClone.remove()}}async function queryToPoints(searchBlock,queryString,color){let offset=0,limit=1e3;for(;;){var json=await getReq(queryString+"&Limit=1000&Offset="+offset),coordonatesObject=Object.values(json);if(offset+=1e3,children=searchBlock.childElementCount,0==json.length)break;if(1==children){destroyBlock(searchBlock);break}for(var coordonatesArray=[],descriptionArray=[],i=0;i<coordonatesObject.length;i++){var lat=coordonatesObject[i].Start_Lat,long=coordonatesObject[i].Start_Lng,desc=coordonatesObject[i].Description;descriptionArray.push(desc),coordonatesArray.push([long,lat])}addPointsToMap(coordonatesArray,descriptionArray,color)}}async function getReq(queryString){return new Promise((resolve,reject)=>{try{fetch("/home?"+queryString,{method:"GET",headers:{Accept:"application/json, */*","Content-type":"application/json"}}).then(res=>res.json()).then(data=>resolve(data))}catch(error){reject(error)}})}function saveData(){localStorage.clear();let inputNames=[],inputValues=[],nameOfBlock=[],collors="";for(var j=0;j<searchBlocks.length;j++){children=searchBlocks[j].childNodes;for(var i=0;i<children.length;i++)void 0!==children[i].name&&""!=children[i].name&&""!=children[i].value&&(inputNames.push(children[i].name),inputValues.push(children[i].value),nameOfBlock.push(searchBlocks[j].id.toString()),searchBlocks[j].style.backgroundColor?collors=collors+"+"+searchBlocks[j].style.backgroundColor:collors+="+rgb(0,0,0)");collors=collors.substr(1)}"undefined"!=typeof Storage?(localStorage.setItem("inputNames",inputNames),localStorage.setItem("inputValues",inputValues),localStorage.setItem("nameOfBlock",nameOfBlock),localStorage.setItem("colorArray",collors)):alert("Browser does not support localStorage")}function loadData(){if("undefined"!=typeof Storage){destroyAllBlocks();const inputNames=localStorage.getItem("inputNames").split(","),inputValues=localStorage.getItem("inputValues").split(","),nameOfBlock=localStorage.getItem("nameOfBlock").split(","),colArr=localStorage.getItem("colorArray").split("+");for(var i=0;i<nameOfBlock.length;i++){let searchBlock=document.getElementById(nameOfBlock[i]);null==searchBlock&&(createSearchBlock(colArr[i],nameOfBlock[i]),searchBlock=document.getElementById(nameOfBlock[i])),addSelect.value=inputNames[i];const func=nameToFunc[addSelect.value];var select;func().value=inputValues[i]}addSelect.value="0",startBlock=document.getElementById("searchBlockStart"),0==startBlock.childElementCount&&destroyBlock(startBlock)}else alert("Browser does not support localStorage")}function destroyAllBlocks(){for(var i=0;i<=searchBlockNo;i++)searchBlocks[i].remove();createStartBlock()}function createStartBlock(){let searchBlockStart=document.createElement("div");searchBlockStart.id="searchBlockStart",searchBlockStart.className="searchBlocks";let submit=document.getElementById("submit");submit.parentNode.insertBefore(searchBlockStart,submit),searchBlocks=[searchBlockStart],searchBlockNo=0}function destroyBlock(block){var index=searchBlocks.indexOf(block);searchBlocks.splice(index,1),searchBlockNo--,block.remove(),-1==searchBlockNo&&createStartBlock()}function createSearchBlock(color,name){newSearchBlock=document.createElement("div"),newSearchBlock.id=""==name?"searchBlock"+searchBlockNo:name,newSearchBlock.className="searchBlocks",newSearchBlock.style.backgroundColor=color,lastSearchBlock=searchBlocks[searchBlockNo],lastSearchBlock.parentNode.insertBefore(newSearchBlock,lastSearchBlock.nextSibling),searchBlockNo+=1,searchBlocks.push(newSearchBlock)}function addRemoveAnnounce(event){deleteSearchBlock=!0,document.body.removeEventListener("click",addRemoveAnnounce)}document.body.addEventListener("click",addRemoveAnnounce);