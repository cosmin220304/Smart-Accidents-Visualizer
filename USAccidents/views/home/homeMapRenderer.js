let map;const clusterNumber=document.getElementById("clusterNumber");let clusterNo=0;var test=[];let startPosX=260,startPosY=38,startZoom=3;const mercatorProjection="EPSG:3857",worldGeodeticSystem="EPSG:4326";let coordArray=[],descArray=[];function renderMap(){map=new ol.Map({target:"map",layers:[new ol.layer.Tile({source:new ol.source.OSM})],view:new ol.View({center:ol.proj.fromLonLat([startPosX,startPosY]),zoom:startZoom}),interactions:ol.interaction.defaults({attribution:!1,rotate:!1}).extend([new ol.interaction.DragAndDrop])})}function addPointsToMap(coordonates,desc,color){size=Object.keys(coordonates).length;for(var points=new Array(size),i=0;i<size;++i)points[i]=new ol.Feature(new ol.geom.Point(coordonates[i]).transform("EPSG:4326","EPSG:3857")),coordArray.push(coordonates[i]),descArray.push(desc[i]);var cluster=new ol.source.Cluster({distance:parseInt(clusterNumber.value,10),source:new ol.source.Vector({features:points})}),points=new ol.layer.Vector({source:cluster,style:feature=>stylePoints(feature,color,!0),id:"points"+clusterNo,class:"points"});test.push(color),clusterNo++,map.addLayer(points)}function stylePoints(feature,color,hasText){var points_no=feature.get("features").length,radius=Math.log2(points_no)+5;let textColor="black";"rgb(0, 0, 0)"==color&&(textColor="white");var textInside=points_no.toString();0==hasText&&(textInside="");var text=new ol.style.Text({text:textInside,fill:new ol.style.Fill({color:textColor})}),circle=new ol.style.Circle({radius:radius,fill:new ol.style.Fill({color:color})});return new ol.style.Style({image:circle,text:text})}function removeAllPoints(){clusterNo=0,test=[],descArray=[],coordArray=[],map.getLayers().getArray().filter(layer=>"points"===layer.get("class")).forEach(layer=>map.removeLayer(layer))}renderMap();var popup=document.getElementById("popup"),overlay=new ol.Overlay({element:popup,stopEvent:!1});map.addOverlay(overlay),map.on("pointermove",event=>{var point=map.forEachFeatureAtPixel(event.pixel,feature=>feature);if(point){var coord=point.getGeometry().getCoordinates();coord=ol.proj.transform(coord,"EPSG:3857","EPSG:4326");let parsedCoord=[];parsedCoord[0]=parseFloat(parseFloat(coord[0]).toFixed(6)),parsedCoord[1]=parseFloat(parseFloat(coord[1]).toFixed(6));let index=-1;for(var i=0;i<coordArray.length;i++)if(coordArray[i][0]==parsedCoord[0]&&coordArray[i][1]==parsedCoord[1]){index=i;break}if(index>=0){null!=descArray[index]&&""!=descArray[index]&&" "!=descArray[index]||(descArray[index]="no data"),popup.innerHTML=descArray[index];var textSize=descArray[index].length,elemSize=textSize/10+"."+textSize%10+"em";popup.setAttribute("style","height:"+elemSize),overlay.setPosition(event.coordinate)}}else overlay.setPosition(void 0)}),clusterNumber.addEventListener("input",(function(){map.renderSync(),map.getLayers().getArray().filter(layer=>"points"===layer.get("class")).forEach(layer=>{layer.getSource().setDistance(parseInt(clusterNumber.value,10))})}));let styleRember=[],state="on";function OnOffText(){if("on"==state){styleRember=new Array(clusterNo);for(var i=0;i<clusterNo;i++)map.getLayers().getArray().filter(layer=>layer.get("id")==="points"+i).forEach(layer=>{styleRember[i]=layer.getStyle(),layer.setStyle(feature=>stylePoints(feature,test[i],!1))});state="off",document.getElementById("hideText").style.backgroundImage="url('icons/closedEye.webp')"}else{for(var i=0;i<clusterNo;i++)map.getLayers().getArray().filter(layer=>layer.get("id")==="points"+i).forEach(layer=>{layer.setStyle(styleRember[i])});state="on",document.getElementById("hideText").style.backgroundImage="url('icons/eye.webp')"}}